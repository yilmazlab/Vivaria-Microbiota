---
title: "Process the rds data"
---

The data is stored in the file physeq.rds
Unpack this file and generate the otu and taxonomy files.
The metadata is saved in a file named "temp_metadata.csv" as it has been updated in the middle of the project with the file "After_Chip126_2022.tsv" and will need to be curated using this file.


Set the save_files boolean to TRUE to allow for overwriting files with this script.

```{r}
rm(list = ls())

save_files = TRUE

library(phyloseq)
library(R.matlab)
```

```{r}
physeq <- readRDS("../data/original_files/physeq.rds")
```

```{r}
tax = data.frame(physeq@tax_table)
otu = data.frame(physeq@otu_table)
meta = data.frame(physeq@sam_data)

```

The taxonomy dataframe contains family S24-7 which is an old name for the Muribaculacae family. We will correct this.
I also need to correct for the Family of Akkermansia muciniphila
```{r}
tax[tax == "S24-7"] <- "Muribaculaceae"
tax$Family[tax$Family == "Verrucomicrobiaceae" & tax$Genus =="Akkermansia"] <- "Akkermansiaceae"
```


```{r}
write.csv(tax, "../data/processed_files/taxonomy.csv")
write.csv(meta, "../data/processed_files/temp_metadata.csv")
saveRDS(otu, "../data/processed_files/otumat.rds")
writeMat(con = "../data/processed_files/otumat.mat", otumat = otu)
```